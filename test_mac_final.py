#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –∏–º–µ–Ω–∏ –±–æ—Ç–∞ "–ú–∞–∫"
"""

import asyncio
import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from ai_assistant import get_ai_response
import config

async def test_mac_functionality():
    """–¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏–º–µ–Ω–∏ –ú–∞–∫"""
    print("ü§ñ –§–ò–ù–ê–õ–¨–ù–´–ô –¢–ï–°–¢ –ò–ú–ï–ù–ò –ë–û–¢–ê '–ú–ê–ö'")
    print("="*50)
    print()
    
    test_scenarios = [
        {
            'name': '–ü—Ä—è–º–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ú–∞–∫—É',
            'tests': [
                '–ú–∞–∫',
                '–ü—Ä–∏–≤–µ—Ç, –ú–∞–∫!',
                '–ú–∞–∫, –ø–æ–º–æ–≥–∏',
                '–ú–∞–∫—Å'
            ]
        },
        {
            'name': '–í–æ–ø—Ä–æ—Å—ã –æ–± –∏–º–µ–Ω–∏',
            'tests': [
                '–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?',
                '–ö—Ç–æ —Ç—ã?',
                '–¢–≤–æ–µ –∏–º—è?'
            ]
        },
        {
            'name': '–í–æ–ø—Ä–æ—Å—ã –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö',
            'tests': [
                '–ß—Ç–æ —Ç—ã —É–º–µ–µ—à—å?',
                '–ß—Ç–æ —É–º–µ–µ—à—å?',
                '–¢–≤–æ–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏?'
            ]
        },
        {
            'name': '–û–±—ã—á–Ω—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è',
            'tests': [
                '–ü—Ä–∏–≤–µ—Ç',
                '–î–æ–±—Ä—ã–π –¥–µ–Ω—å',
                '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π'
            ]
        }
    ]
    
    total_passed = 0
    total_tests = 0
    
    for scenario in test_scenarios:
        print(f"üìã {scenario['name']}:")
        print("-" * 30)
        
        for test_message in scenario['tests']:
            total_tests += 1
            try:
                result = await get_ai_response(test_message, 999999999)
                response_text = result.get('text', '')
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–º–µ–Ω–∏ "–ú–∞–∫"
                has_mac_name = '–º–∞–∫' in response_text.lower()
                
                if has_mac_name:
                    print(f"‚úÖ '{test_message}' ‚Üí –£–ø–æ–º–∏–Ω–∞–µ—Ç –∏–º—è –ú–∞–∫")
                    total_passed += 1
                else:
                    print(f"‚ùå '{test_message}' ‚Üí –ù–ï —É–ø–æ–º–∏–Ω–∞–µ—Ç –∏–º—è –ú–∞–∫")
                
                # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç
                short_response = response_text[:80] + "..." if len(response_text) > 80 else response_text
                print(f"   üìù {short_response}")
                print()
                
            except Exception as e:
                print(f"üí• –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ '{test_message}': {e}")
                print()
        
        print()
    
    # –¢–µ—Å—Ç —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    print("üì± –°–¢–ê–†–¢–û–í–û–ï –°–û–û–ë–©–ï–ù–ò–ï:")
    print("-" * 30)
    start_message = config.START_MESSAGE
    has_mac_in_start = '–º–∞–∫' in start_message.lower()
    
    if has_mac_in_start:
        print("‚úÖ –°—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º—è '–ú–∞–∫'")
        total_passed += 1
    else:
        print("‚ùå –°—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º—è '–ú–∞–∫'")
    
    total_tests += 1
    print(f"üìù –ù–∞—á–∞–ª–æ: {start_message[:100]}...")
    print()
    
    # –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    print("="*50)
    print("üèÅ –ò–¢–û–ì–û–í–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´:")
    print(f"‚úÖ –£—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤: {total_passed}/{total_tests}")
    print(f"üìä –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞: {(total_passed/total_tests)*100:.1f}%")
    print()
    
    if total_passed == total_tests:
        print("üéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´ –£–°–ü–ï–®–ù–û!")
        print("‚úÖ –ë–æ—Ç –ú–∞–∫ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")
        print("‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –ø–æ –∏–º–µ–Ω–∏")
        print("‚úÖ –û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ '–ú–∞–∫'")
        print("‚úÖ –£–ø–æ–º–∏–Ω–∞–µ—Ç –∏–º—è –≤ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è—Ö")
        print("‚úÖ –°—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ")
        print()
        print("üöÄ –°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –ü–†–û–î–ê–ö–®–ï–ù–£!")
        
    else:
        print("‚ö†Ô∏è –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏")
        print("–¢—Ä–µ–±—É—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è")
    
    return total_passed == total_tests

async def demo_conversation():
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ —Å –ú–∞–∫–æ–º"""
    print("\nüé≠ –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –†–ê–ó–ì–û–í–û–†–ê –° –ú–ê–ö–û–ú:")
    print("="*50)
    
    demo_messages = [
        "–ü—Ä–∏–≤–µ—Ç!",
        "–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?", 
        "–ú–∞–∫, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å?",
        "–£ –≤–∞—Å –µ—Å—Ç—å –ø–∏—Ü—Ü–∞?"
    ]
    
    for i, message in enumerate(demo_messages, 1):
        print(f"\n{i}. üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: '{message}'")
        
        try:
            result = await get_ai_response(message, 999999999)
            response = result.get('text', '–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞')
            
            # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            if len(response) > 200:
                response = response[:200] + "..."
            
            print(f"   ü§ñ –ú–∞–∫: {response}")
            
        except Exception as e:
            print(f"   üí• –û—à–∏–±–∫–∞: {e}")

async def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("üöÄ –ó–ê–ü–£–°–ö –§–ò–ù–ê–õ–¨–ù–û–ì–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –ò–ú–ï–ù–ò –ë–û–¢–ê '–ú–ê–ö'...\n")
    
    success = await test_mac_functionality()
    await demo_conversation()
    
    print(f"\n{'='*50}")
    print("üèÜ –§–ò–ù–ê–õ–¨–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:")
    
    if success:
        print("üéâ –ó–ê–î–ê–ß–ê –í–´–ü–û–õ–ù–ï–ù–ê –£–°–ü–ï–®–ù–û!")
        print("–ë–æ—Ç —Ç–µ–ø–µ—Ä—å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è '–ú–∞–∫' –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è!")
    else:
        print("üí• –¢—Ä–µ–±—É—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è")

if __name__ == "__main__":
    asyncio.run(main())