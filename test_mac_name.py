#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–¢–µ—Å—Ç –∏–º–µ–Ω–∏ –±–æ—Ç–∞ "–ú–∞–∫"
"""

import asyncio
import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from ai_assistant import get_ai_response

async def test_mac_name():
    """–¢–µ—Å—Ç –∏–º–µ–Ω–∏ –∏ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ –ú–∞–∫—É"""
    print("ü§ñ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∏–º—è –±–æ—Ç–∞ '–ú–∞–∫'...\n")
    
    test_cases = [
        # –û–±—Ä–∞—â–µ–Ω–∏—è –∫ –ú–∞–∫—É
        ("–ú–∞–∫", "–æ–±—Ä–∞—â–µ–Ω–∏–µ –ø–æ –∏–º–µ–Ω–∏"),
        ("–ü—Ä–∏–≤–µ—Ç, –ú–∞–∫!", "–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –∏–º–µ–Ω–µ–º"),
        ("–ú–∞–∫, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å?", "–≤–æ–ø—Ä–æ—Å —Å –æ–±—Ä–∞—â–µ–Ω–∏–µ–º"),
        ("–ú–∞–∫—Å", "–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –∏–º—è"),
        
        # –í–æ–ø—Ä–æ—Å—ã –æ–± –∏–º–µ–Ω–∏
        ("–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?", "–≤–æ–ø—Ä–æ—Å –æ–± –∏–º–µ–Ω–∏"),
        ("–ö—Ç–æ —Ç—ã?", "–≤–æ–ø—Ä–æ—Å –æ –ª–∏—á–Ω–æ—Å—Ç–∏"),
        ("–¢–≤–æ–µ –∏–º—è?", "–ø—Ä—è–º–æ–π –≤–æ–ø—Ä–æ—Å –æ–± –∏–º–µ–Ω–∏"),
        
        # –í–æ–ø—Ä–æ—Å—ã –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö
        ("–ß—Ç–æ —Ç—ã —É–º–µ–µ—à—å?", "–≤–æ–ø—Ä–æ—Å –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö"),
        ("–ß—Ç–æ —É–º–µ–µ—à—å?", "–∫–æ—Ä–æ—Ç–∫–∏–π –≤–æ–ø—Ä–æ—Å –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö"),
        
        # –û–±—ã—á–Ω—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
        ("–ü—Ä–∏–≤–µ—Ç", "–æ–±—ã—á–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ"),
        ("–î–æ–±—Ä—ã–π –¥–µ–Ω—å", "—Ñ–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ"),
    ]
    
    passed = 0
    failed = 0
    
    for message, description in test_cases:
        try:
            print(f"üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º: '{message}' ({description})")
            result = await get_ai_response(message, 999999999)
            
            response_text = result.get('text', '').lower()
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –±–æ—Ç —É–ø–æ–º–∏–Ω–∞–µ—Ç —Å–≤–æ–µ –∏–º—è "–ú–∞–∫"
            mentions_name = '–º–∞–∫' in response_text
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—Ä—É–∂–µ–ª—é–±–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞
            is_friendly = any(word in response_text for word in ['–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π', '–¥–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å', 'üòä', 'üëã'])
            
            # –î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–± –∏–º–µ–Ω–∏ - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–º—è
            if any(phrase in message.lower() for phrase in ['–∫–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç', '–∫—Ç–æ —Ç—ã', '—Ç–≤–æ–µ –∏–º—è']):
                if mentions_name:
                    print(f"‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª—Å—è –∫–∞–∫ –ú–∞–∫")
                    passed += 1
                else:
                    print(f"‚ùå –ù–ï –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª—Å—è –∫–∞–∫ –ú–∞–∫")
                    failed += 1
            
            # –î–ª—è –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ –ú–∞–∫—É - –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å –¥—Ä—É–∂–µ–ª—é–±–Ω–æ
            elif any(name in message.lower() for name in ['–º–∞–∫', '–º–∞–∫—Å']):
                if mentions_name and is_friendly:
                    print(f"‚úÖ –î—Ä—É–∂–µ–ª—é–±–Ω–æ –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ")
                    passed += 1
                else:
                    print(f"‚ùå –ù–ï –æ—Ç–≤–µ—Ç–∏–ª –¥—Ä—É–∂–µ–ª—é–±–Ω–æ –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ")
                    failed += 1
            
            # –î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö - –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å—Å—è –∏ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö
            elif '—É–º–µ–µ—à—å' in message.lower():
                has_capabilities = any(word in response_text for word in ['–º–µ–Ω—é', '–±—Ä–æ–Ω–∏—Ä', '–¥–æ—Å—Ç–∞–≤–∫', '–ø–æ–º–æ–≥'])
                if mentions_name and has_capabilities:
                    print(f"‚úÖ –ü—Ä–µ–¥—Å—Ç–∞–≤–∏–ª—Å—è –∏ —Ä–∞—Å—Å–∫–∞–∑–∞–ª –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö")
                    passed += 1
                else:
                    print(f"‚ùå –ù–ï –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª—Å—è –∏–ª–∏ –Ω–µ —Ä–∞—Å—Å–∫–∞–∑–∞–ª –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö")
                    failed += 1
            
            # –î–ª—è –æ–±—ã—á–Ω—ã—Ö –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º
            else:
                if is_friendly:
                    print(f"‚úÖ –î—Ä—É–∂–µ–ª—é–±–Ω–æ –ø–æ–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª")
                    passed += 1
                else:
                    print(f"‚ùå –ù–ï –¥—Ä—É–∂–µ–ª—é–±–Ω–æ –ø–æ–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª")
                    failed += 1
            
            print(f"üìù –û—Ç–≤–µ—Ç: {result.get('text', '')[:100]}...")
            print()
            
        except Exception as e:
            print(f"üí• –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ '{message}': {e}")
            failed += 1
            print()
    
    print(f"üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–º–µ–Ω–∏ '–ú–∞–∫':")
    print(f"‚úÖ –£—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤: {passed}")
    print(f"‚ùå –ù–µ—É–¥–∞—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤: {failed}")
    
    if failed == 0:
        print("üéâ –ú–∞–∫ –æ—Ç–ª–∏—á–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è!")
    else:
        print("‚ö†Ô∏è –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º –∏–ª–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è–º–∏")
    
    return failed == 0

async def test_start_message():
    """–¢–µ—Å—Ç —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è"""
    print("\nüì± –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...")
    
    # –ß–∏—Ç–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ config
    import config
    start_message = config.START_MESSAGE
    
    print("üìù –°—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:")
    print(start_message[:200] + "...")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤ —Å—Ç–∞—Ä—Ç–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –µ—Å—Ç—å –∏–º—è –ú–∞–∫
    if '–º–∞–∫' in start_message.lower():
        print("‚úÖ –°—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º—è '–ú–∞–∫'")
        return True
    else:
        print("‚ùå –°—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º—è '–ú–∞–∫'")
        return False

async def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    print("üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–º–µ–Ω–∏ –±–æ—Ç–∞ '–ú–∞–∫'...\n")
    
    success1 = await test_mac_name()
    success2 = await test_start_message()
    
    print(f"\nüèÅ –ò–¢–û–ì–û–í–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:")
    if success1 and success2:
        print("üéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´!")
        print("‚úÖ –ë–æ—Ç –ú–∞–∫ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")
        print("‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è")
        print("‚úÖ –û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è –ø–æ –∏–º–µ–Ω–∏")
        print("‚úÖ –°—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ")
    else:
        print("üí• –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –∏–º–µ–Ω–µ–º –±–æ—Ç–∞")

if __name__ == "__main__":
    asyncio.run(main())