#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–§–∏–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π AI —Å–∏—Å—Ç–µ–º—ã
–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—á–Ω–æ —Ç–æ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
"""

import asyncio
import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from ai_assistant import get_ai_response

async def test_exact_user_scenario():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º —Ç–æ—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    print("üéØ –¢–ï–°–¢–ò–†–£–ï–ú –¢–û–ß–ù–´–ô –°–¶–ï–ù–ê–†–ò–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø")
    print("="*60)
    print()
    
    print("üìã –ü–†–û–ë–õ–ï–ú–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:")
    print("1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: '–ö–∞–∫–∞—è –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å —É –ø–∏—Ü—Ü—ã?'")
    print("2. AI: –æ—Ç–≤–µ—á–∞–µ—Ç –æ –ø–∏—Ü—Ü–µ")
    print("3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: '–•–æ—á—É'")
    print("4. AI: –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–∏—Ü—Ü, –Ω–æ –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–ª")
    print()
    print("üîß –û–ñ–ò–î–ê–ï–ú–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï:")
    print("AI –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–∏—Ü—Ü —Å —Ü–µ–Ω–∞–º–∏ –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç '–•–æ—á—É'")
    print()
    print("="*60)
    print()
    
    # –®–∞–≥ 1: –í–æ–ø—Ä–æ—Å –æ –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏
    print("üë§ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨: '–ö–∞–∫–∞—è –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å —É –ø–∏—Ü—Ü—ã?'")
    result1 = await get_ai_response("–ö–∞–∫–∞—è –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å —É –ø–∏—Ü—Ü—ã?", 999999999)
    print(f"ü§ñ AI –û–¢–í–ï–¢–ò–õ: {result1.get('text', '–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞')}")
    print()
    
    # –®–∞–≥ 2: –ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç "–•–æ—á—É"
    print("üë§ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨: '–•–æ—á—É'")
    result2 = await get_ai_response("–•–æ—á—É", 999999999)
    ai_response = result2.get('text', '–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞')
    print(f"ü§ñ AI –û–¢–í–ï–¢–ò–õ: {ai_response[:150]}...")
    print()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    print("üîç –ê–ù–ê–õ–ò–ó –û–¢–í–ï–¢–ê:")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ï—Å—Ç—å –ª–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø–∏—Ü—Ü—ã
    has_pizza_mention = '–ø–∏—Ü—Ü' in ai_response.lower()
    print(f"   ‚úì –£–ø–æ–º–∏–Ω–∞–µ—Ç –ø–∏—Ü—Ü—É: {'‚úÖ –î–ê' if has_pizza_mention else '‚ùå –ù–ï–¢'}")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ï—Å—Ç—å –ª–∏ —Ü–µ–Ω—ã
    has_prices = '‚ÇΩ' in ai_response
    print(f"   ‚úì –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ü–µ–Ω—ã: {'‚úÖ –î–ê' if has_prices else '‚ùå –ù–ï–¢'}")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ï—Å—Ç—å –ª–∏ —Å–ø–∏—Å–æ–∫ (–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–∑–∏—Ü–∏–π)
    pizza_count = ai_response.lower().count('–ø–∏—Ü—Ü–∞')
    has_list = pizza_count >= 3
    print(f"   ‚úì –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫: {'‚úÖ –î–ê' if has_list else '‚ùå –ù–ï–¢'} ({pizza_count} –ø–æ–∑–∏—Ü–∏–π)")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 4: –ï—Å—Ç—å –ª–∏ –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é
    has_call_to_action = any(phrase in ai_response.lower() for phrase in [
        '—Å–ø—Ä–æ—Å–∏—Ç–µ', '–≤—ã–±–µ—Ä–∏—Ç–µ', '–∑–∞–∫–∞–∂–∏—Ç–µ', '–ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ', '—Ñ–æ—Ç–æ'
    ])
    print(f"   ‚úì –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é: {'‚úÖ –î–ê' if has_call_to_action else '‚ùå –ù–ï–¢'}")
    
    print()
    print("="*60)
    
    # –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞
    all_checks_passed = has_pizza_mention and has_prices and has_list and has_call_to_action
    
    if all_checks_passed:
        print("üéâ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê! ‚úÖ")
        print()
        print("‚úÖ AI —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–∏—Ü—Ü")
        print("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å —Ü–µ–Ω–∞–º–∏")
        print("‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-–∑–∞–≤–∏—Å–∏–º—ã–µ –æ—Ç–≤–µ—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç")
        print("‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞")
        print()
        print("üöÄ –°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –ü–†–û–î–ê–ö–®–ï–ù–£!")
        
    else:
        print("‚ùå –ü–†–û–ë–õ–ï–ú–ê –ù–ï –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–ê")
        print()
        print("–ß—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:")
        if not has_pizza_mention:
            print("   - AI –Ω–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç –ø–∏—Ü—Ü—É –≤ –æ—Ç–≤–µ—Ç–µ")
        if not has_prices:
            print("   - AI –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ü–µ–Ω—ã")
        if not has_list:
            print("   - AI –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫")
        if not has_call_to_action:
            print("   - AI –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –¥–∞–ª—å–Ω–µ–π—à–∏–µ –¥–µ–π—Å—Ç–≤–∏—è")
    
    return all_checks_passed

async def test_additional_scenarios():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã"""
    print("\nüîç –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –¢–ï–°–¢–´:")
    print("="*40)
    
    scenarios = [
        ("–£ –≤–∞—Å –µ—Å—Ç—å –ø–∏—Ü—Ü–∞?", "–ø—Ä—è–º–æ–π –≤–æ–ø—Ä–æ—Å –æ –ø–∏—Ü—Ü–µ"),
        ("–ö–∞–∫–∏–µ —Å—É–ø—ã –µ—Å—Ç—å?", "–≤–æ–ø—Ä–æ—Å –æ —Å—É–ø–∞—Ö"),
        ("–ü–∏—Ü—Ü–∞ –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞", "–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –±–ª—é–¥–æ"),
    ]
    
    all_passed = True
    
    for query, description in scenarios:
        print(f"\nüìù –¢–µ—Å—Ç: {description}")
        print(f"üë§ –ó–∞–ø—Ä–æ—Å: '{query}'")
        
        result = await get_ai_response(query, 999999999)
        
        if result.get('type') == 'photo_with_text':
            print("‚úÖ –ü–æ–∫–∞–∑–∞–ª —Ñ–æ—Ç–æ –±–ª—é–¥–∞")
        elif result.get('type') == 'text' and ('‚ÇΩ' in result.get('text', '') or '—Ü–µ–Ω–∞' in result.get('text', '').lower()):
            print("‚úÖ –ü–æ–∫–∞–∑–∞–ª —Å–ø–∏—Å–æ–∫ —Å —Ü–µ–Ω–∞–º–∏")
        else:
            print("‚ö†Ô∏è –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç")
            all_passed = False
    
    return all_passed

async def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏"""
    print("üöÄ –§–ò–ù–ê–õ–¨–ù–ê–Ø –í–ê–õ–ò–î–ê–¶–ò–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô AI –°–ò–°–¢–ï–ú–´")
    print("="*60)
    print()
    
    # –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ—Å—Ç
    main_test_passed = await test_exact_user_scenario()
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
    additional_tests_passed = await test_additional_scenarios()
    
    print("\n" + "="*60)
    print("üèÅ –§–ò–ù–ê–õ–¨–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:")
    
    if main_test_passed and additional_tests_passed:
        print("üéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´ –£–°–ü–ï–®–ù–û!")
        print()
        print("‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞")
        print("‚úÖ AI –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã")
        print("‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç")
        print("‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-–∑–∞–≤–∏—Å–∏–º—ã–µ –æ—Ç–≤–µ—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç")
        print()
        print("üöÄ –°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ!")
        
    else:
        print("‚ö†Ô∏è –ï–°–¢–¨ –ü–†–û–ë–õ–ï–ú–´:")
        if not main_test_passed:
            print("   - –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç")
        if not additional_tests_passed:
            print("   - –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç")

if __name__ == "__main__":
    asyncio.run(main())