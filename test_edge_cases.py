#!/usr/bin/env python3
"""
–¢–µ—Å—Ç –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
"""

import asyncio
import sys
import os
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from ai_assistant import get_ai_response

async def test_edge_cases():
    print("üß™ –¢–ï–°–¢ –ì–†–ê–ù–ò–ß–ù–´–• –°–õ–£–ß–ê–ï–í –ë–†–û–ù–ò–†–û–í–ê–ù–ò–Ø")
    print("=" * 60)
    
    user_id = 515216260
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∑–∞–ø–∏—Å–∏
    test_cases = [
        # –ì—Ä–∞–Ω–∏—Ü–∞ 4-5 —á–µ–ª–æ–≤–µ–∫
        "4 —á–µ–ª–æ–≤–µ–∫–∞, –∑–∞–≤—Ç—Ä–∞ –≤ 19:00",  # –î–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
        "5 —á–µ–ª–æ–≤–µ–∫, –∑–∞–≤—Ç—Ä–∞ –≤ 19:00",   # –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã
        
        # –†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∑–∞–ø–∏—Å–∏
        "–°—Ç–æ–ª–∏–∫ –Ω–∞ 3, 23 —è–Ω–≤–∞—Ä—è, 20:30",
        "7 –≥–æ—Å—Ç–µ–π —Å–µ–≥–æ–¥–Ω—è –≤ 18.00",
        "2 —á–µ–ª, —á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é, –≤ 19:30",
        
        # –°–º–µ—à–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
        "–ü—Ä–∏–≤–µ—Ç! –•–æ—á—É —Å—Ç–æ–ª–∏–∫ –Ω–∞ 6 —á–µ–ª–æ–≤–µ–∫ –∑–∞–≤—Ç—Ä–∞ –≤ 20:00",
        "–ú–æ–∂–Ω–æ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 8 –≥–æ—Å—Ç–µ–π 25 —è–Ω–≤–∞—Ä—è –≤ 19:30?",
        
        # –ù–ï –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
        "–£ –≤–∞—Å –µ—Å—Ç—å —Å—Ç–æ–ª–∏–∫–∏?",
        "–°–∫–æ–ª—å–∫–æ —á–µ–ª–æ–≤–µ–∫ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –∑–∞ —Å—Ç–æ–ª–æ–º?",
    ]
    
    for i, test_case in enumerate(test_cases, 1):
        print(f"\n{i}. üß™ –¢–µ—Å—Ç: '{test_case}'")
        print("-" * 50)
        
        try:
            result = await get_ai_response(test_case, user_id)
            
            if result.get('parse_booking'):
                print("‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ –∫–∞–∫ –ë–†–û–ù–ò–†–û–í–ê–ù–ò–ï")
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä—Å–∏–Ω–≥
                from handlers.handlers_main import parse_booking_message
                booking_details = parse_booking_message(test_case)
                if booking_details:
                    guests = booking_details['guests']
                    date_str = booking_details['date_str']
                    time_str = booking_details['time_str']
                    
                    print(f"üìÖ –î–µ—Ç–∞–ª–∏: {guests} –≥–æ—Å—Ç–µ–π, {date_str}, {time_str}")
                    
                    if guests > 4:
                        print("üîÑ –î–µ–π—Å—Ç–≤–∏–µ: –ü–æ–∫–∞–∂–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞")
                    else:
                        print("üîÑ –î–µ–π—Å—Ç–≤–∏–µ: –ó–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è")
                else:
                    print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–µ—Ç–∞–ª–∏")
                    
            elif result.get('show_booking_options'):
                print("‚úÖ –ü–æ–∫–∞–∂–µ—Ç –º–µ–Ω—é –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è")
                
            else:
                print("üìù –û–±—ã—á–Ω—ã–π –æ—Ç–≤–µ—Ç")
                text = result.get('text', '')
                print(f"   {text[:80]}...")
                
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    
    print("\n" + "=" * 60)
    print("üéØ –ò–¢–û–ì–ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:")
    print("‚úÖ AI —É–º–µ–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ª—é–±–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ")
    print("‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∑–∞–ø–∏—Å–∏")
    print("‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–∑–ª–∏—á–∞–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—ã—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã")
    print("‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ (4 vs 5 —á–µ–ª–æ–≤–µ–∫)")

if __name__ == "__main__":
    asyncio.run(test_edge_cases())